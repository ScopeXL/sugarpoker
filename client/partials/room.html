<div id="room">
    <div class="container" id="room-setup">
        <div class="row app-title">
            <div class="col-xs-12">
                <div class="poker-title">
                    Planning Poker
                </div>
                <div class="poker-subtitle">
                    Joining: <span class="room-name">{{roomId}}</span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="room-setup">
                    <form ng-submit="join()">
                        <div class="name">
                            <input type="text" ng-model="username" ng-change="changeUsername()" placeholder="Your Name" />
                        </div>
                        <button type="submit" class="join">Join</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid" id="room-details">
        <div class="row topic-container">
            <div class="col-xs-9">
                <div class="topic" ng-show="!showEditTopic" ng-click="handleEditTopic(true)">
                    <div class="topic-text">{{room.get('topic') ? room.get('topic') : 'Edit Topic...'}}</div>
                </div>
                <div class="topic" ng-show="showEditTopic">
                    <input id="input-topic" class="form-control" type="text" ng-model="room.details.topic" ng-change="editTopic()" ng-enter="handleEditTopic(false)" ng-blur="handleEditTopic(false)" placeholder="Edit Topic..." />
                </div>
            </div>
            <div class="col-xs-3">
                <div class="countdown-container">
                    <div ng-show="!editCountdown" class="timer-controls pull-right">
                        <span ng-show="!timerRunning" ng-click="pauseTimer(false)" class="glyphicon glyphicon-play control"></span>
                        <span ng-show="timerRunning" ng-click="pauseTimer(true)" class="glyphicon glyphicon-pause control"></span>
                    </div>
                    <timer ng-show="!editCountdown" ng-click="handleEditCountdown(true)" countdown="timerCountdown" interval="1000" autostart="false" class="countdown">
                        <span class="text-{{progressLevel}}">{{mminutes}}:{{sseconds}}</span>
                        <div class="progress">
                            <div class="progress-bar {{progressLevel}}" style="width: {{progressBar}}%;"></div>
                        </div>
                    </timer>
                    <div class="countdown-edit" ng-show="editCountdown">
                        <input id="input-countdown" ng-model="customCountdown" ng-blur="handleEditCountdown(false)" class="form-control" type="text" placeholder="MM:SS" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="options text-right">
                    <div class="option" ng-show="room.get('activeVote')">
                        <a ng-click="revealVote()">Reveal Results</a>
                    </div>
                    <div class="option">
                        <a ng-click="inviteOthers()">Invite Others</a>
                    </div>
                    <div class="option">
                        <a ng-click="resetVote()">Reset</a>
                    </div>
                    <div class="option">
                        <a ng-click="startVote()">Call for Vote</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="users">
            <div class="user-container{{user.get('socketId') == socketId ? ' local' : ''}}" ng-repeat="user in users">
                <div class="flip-container{{(voteEnd && user.get('hasVoted')) || reveal ? ' flip' : ''}}">
                    <div class="flipper">
                        <div class="front{{user.get('socketId') == socketId ? ' local' : ''}}" ng-click="editVote(user.get('socketId'))">
                            <div ng-show="!user.get('hasVoted')">Poker</div>
                            <div ng-show="user.get('hasVoted')" class="user-voted">
                                <span class="glyphicon glyphicon-ok"></span>
                            </div>
                        </div>
                        <div class="back">
                            <div>{{user.get('vote')}}</div>
                        </div>
                    </div>
                </div>
                <div class="video-container" ng-show="user.get('activeCall')">
                    <div ng-show="user.get('activeWebcam')">
                        <div class="local-video" ng-if="socketId === user.get('socketId')">
                            <video class="mirror" id="video-local" autoplay muted></video>
                        </div>
                        <div class="remote-video" ng-if="socketId !== user.get('socketId')">
                            <video id="video-{{user.get('socketId')}}" autoplay></video>
                        </div>
                    </div>
                    <div class="audio-call-container" ng-show="!user.get('activeWebcam')">
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="user-info">
                        {{user.get('username')}}
                    </div>
                    <div class="user-muted" ng-show="user.get('muted')"></div>
                    <div class="video-option webcam" ng-click="toggleCall('end')">
                        <i class="fa fa-video-camera control"></i>
                    </div>
                    <div class="video-option microphone{{user.get('muted') ? ' muted' : ''}}" ng-click="toggleMicrophone()">
                        <i class="fa {{user.get('muted') ? 'fa-microphone-slash' : 'fa-microphone'}} control"></i>
                    </div>
                </div>
                <div class="username" ng-show="!user.get('activeCall')">
                    {{user.get('username')}}
                </div>
                <div class="user-options" ng-show="!user.get('activeCall')">
                    <div class="option" ng-click="toggleCall('video')" title="Start Video Call" tooltip>
                        <i class="fa fa-video-camera control"></i>
                    </div>
                    <div class="option" ng-click="toggleCall('audio')" title="Start Audio Call" tooltip>
                        <i class="fa fa-microphone control"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div ng-include="'partials/invite.html'"></div>

    <div id="vote-modal" class="modal fade" tabindex="-1" role="dialog" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Vote!</h4>
                </div>
                <div class="modal-body">
                    <div class="grouping">
                        <div class="btn-group btn-group-justified" role="group" aria-label="...">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(0)">0</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(0.5)">0.5</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(1)">1</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(2)">2</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(3)">3</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(5)">5</button>
                            </div>
                        </div>
                    </div>

                    <div class="grouping">
                        <div class="btn-group btn-group-justified" role="group" aria-label="...">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(8)">8</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(13)">13</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(21)">21</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(34)">34</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(55)">55</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-click="castVote(89)">89</button>
                            </div>
                        </div>
                    </div>
                    <div class="text-right grouping no-vote">
                        <button type="button" class="btn btn-default" ng-click="castVote('unknown')" title="Unknown" data-placement="top" tooltip>
                            <i class="fa fa-question vote-unknown"></i>
                        </button>
                        <button type="button" class="btn btn-default" ng-click="castVote('abstain')" title="Abstain" data-placement="top" tooltip>
                            <i class="fa fa-times vote-abstain"></i>
                        </button>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="disconnect-overlay">
        <div class="banner">
            Disconnected
            <div class="subtitle">
                You've been disconnected from the room. Trying to reconnect...
            </div>
        </div>
    </div>
</div>
